<!DOCTYPE html>
<html>
    <head>
        <title>Backup List</title>
        <script type="text/javascript">

            if(typeof clouds === 'undefined') {
                load_data_from_file(CLOUDS_CONF_FILE, populate_clouds);
            } else {
                populate_clouds("");
            }
            if(typeof selected_backup != 'undefined') {
                $("#selected-bar").html(selected_backup);
                $("#selected-bar").show();
                load_backup(backups[selected_backup]);
            } else {
                $("#selected-bar").hide();
                load_backup();
            }

            function activate_li(id) {
                $("li").each(function(i, li) {
                    if($(this).is("#" + id)) {
                        $(this).addClass("active-li");
                    } else {
                        $(this).removeClass("active-li");
                    }
                });
            }

            function check_backup_name() {
                var backup_name = $('#backup-name').val().replace(/^\s+|\s+$/gm,'');
                if(!backup_name) {
                    $('#backup-name-error small').text(errors.backup_name_empty);
                    $('#backup-name-error small').show();
                    return false;
                } else {
                    var pattern = /^Backup_[\w.\-]+$/;
                    if(!backup_name.match(pattern)) {
                        $('#backup-name-error small').text(errors.backup_name_illegal);
                        $('#backup-name-error small').show();
                        return false;
                    } else {
                        $('#backup-name-error small').hide();
                    }
                }
                return true;
            }

            function check_cloud() {
                var cloud = $("#cloud").val();
                if(!cloud) {
                    $('#cloud-error small').text(errors.cloud_empty);
                    $('#cloud-error small').show();
                    return false;
                } else {
                    $('#cloud-error small').hide();
                }
                return true;
            }

            function check_passphrase() {
                var passphrase = $("#passphrase").val();
                if(!passphrase) {
                    $('#passphrase-error small').text(errors.passphrase_empty);
                    $('#passphrase-error small').show();
                    return false;
                } else {
                    $('#passphrase-error small').hide();
                }
                return true;
            }

            function populate_clouds(data) {
                if(typeof clouds === 'undefined') {
                    if(data != "") {
                        clouds = JSON.parse(data);
                    } else {
                        clouds = new Object();
                    }
                }
                var cloud_sel = $("#cloud");
                $.each(clouds, function(i, cloud) {
                    cloud_sel.append($("<option></option>")
                        .attr("value", cloud.name)
                        .text(cloud.name));
                });
            }

            function disable_form(disable) {
                $("#backup-name").prop("disabled", disable);
                $("#choose-dir").prop("disabled", disable);
                $("#cloud").prop("disabled", disable);
                var save_pass = $("#save_passphrase").is(":checked");
                if(save_pass) {
                    $("#passphrase").prop("disabled", disable);
                }
                if(disable) {
                    $("#save_button").hide();
                    $("#go_to_restore_button").show();
                } else {
                    $("#save_button").show();
                    $("#go_to_restore_button").hide();
                }
            }

            function disable_actions(disable) {
                $("#backup_details_link").prop("disabled", disable);
                $("#status_link").prop("disabled", disable);
                $("#timeview_link").prop("disabled", disable);
                if(disable) {
                    $("#backup_details_link").attr("click", "");
                    $("#status_link").click(function(e) { e.preventDefault(); });
                    $("#status_link").unbind("click");
                    $("#timeview_link").click(function(e) { e.preventDefault(); });
                    $("#timeview_link").unbind("click");
                } else {
                    $("#backup_detais_link").click(function(e) { load_backup(); });
                    $("#status_link").click(function(e) { load_status(); });
                    $("#timeview_link").click(function(e) { load_timeview(); });
                }
            }

            function disable_buttons(disable) {
                $("#backup_button").attr("disabled", disable);
                if(disable) {
                    $("#backup_button").attr("onclick", "");
                } else {
                    $("#backup_button").attr("onclick", "if(check_fields()) backup(false);");
                }
            }

            function check_fields() {
                return(check_directory("directory")
                    && check_cloud()
                    && check_backup_name()
                    && check_passphrase());
            }

            function go_to_restore() {
                g_res_directory = RESTORE_DEFAULT_DIR;
                g_passphrase = $("#passphrase").val();
                g_res_file = "";
                g_timestamp = "";
                $("#restore-tab-link").trigger("click");
            }
        </script>
    </head>

    <body>
        <div class="row">
            <div class="small-12 columns selected-bar" id="selected-bar"></div>
            <div class="small-2 columns" id="sidebar">
                <a href="#" onclick="load_backup();" class="button radius small">
                    <i class="fa fa-plus-circle">&nbsp;Add</i>
                </a>
            </div>
            <div class="small-10 columns">
                <ul class="tabs" data-tab>
                    <li class="tab-title radius" id="backup_details_tab">
                        <a href="#backup_details" onclick="$('#backup_details').show()"
                            id="backup_details_link">Settings</a>
                    </li>
                    <li class="tab-title radius">
                        <a href="#timeview" id="timeview_link">Timeview</a>
                    </li>
                    <li class="tab-title radius">
                        <a href="#status" id="status_link">Status</a>
                    </li>
                </ul>
                <div class="tabs-content">
                    <div class="content" id="backup_details">
                        <div id="save-alert" class="hide">
                            <div data-alert class="alert-box success radius">
                                Successfully saved backup set.
                                <a href="#" class="close">&times;</a>
                            </div>
                        </div>
                        <form>
                            <fieldset>
                                <legend>From</legend>
                                <div class="clearfix">
                                    <div class="small-3 columns">
                                        <label id="directory_label" for="directory" class="right">
                                            Local directory
                                        </label>
                                    </div>
                                    <div id="directory" class="small-6 columns"></div>
                                    <div id="dirdialogue_label" onclick="$('#choose-dir').trigger('click');"
                                        class="small-3 columns" id="dirpick">
                                        <i class="fa fa-folder-o blue-folder">&nbsp;</i>
                                    </div>
                                </div>
                                <div class="clearfix">
                                    <div class="small-3 columns">&nbsp;</div>
                                    <div id="directory-error" class="small-6 columns">
                                        <small class="error"></small>
                                    </div>
                                    <input type="file" id="choose-dir" nwdirectory
                                        style="display:none;"
                                        onchange="$('#directory').html($(this).val());
                                            check_directory('directory');" />
                                </div>
                            </fieldset>
                            <fieldset>
                                <legend>To</legend>
                                <div class="clearfix">
                                    <div class="small-3 columns">
                                         <label id="cloud_label" for="cloud" class="right inline">Cloud</label>
                                    </div>
                                    <div class="small-9 columns error" id="cloud-error">
                                        <select id="cloud" onchange="check_cloud();">
                                        </select>
                                        <small class="error"></small>
                                    </div>
                                </div>
                                <div class="clearfix">
                                    <div class="small-3 columns">
                                         <label id="backup_name_label" for="backup-name" class="right inline">
                                            Name&nbsp;<i class="fa fa-info-circle green-info"
                                             onclick="$('#name-info').slideDown();"></i>
                                         </label>
                                    </div>
                                    <div class="small-9 columns error" id="backup-name-error">
                                        <input type="text" id="backup-name"
                                        placeholder="Backup_[A-Za-z0-9-_]"
                                        value="Backup_"
                                        onchange="check_backup_name();">
                                        <small class="error"></small>
                                    </div>
                                    <div class="small-3 columns">&nbsp;</div>
                                    <div class="small-9 columns hide info-text panel" id="name-info">
                                        <i class="fa fa-times right" onclick="$('#name-info').slideUp();"></i>
                                        Backup name will also appear as a container in your cloud
                                    </div>
                                </div>
                            </fieldset>
                            <fieldset>
                                <div class="clearfix">
                                    <div class="small-3 columns">
                                         <label id="exclude-label" for="exclude" class="right inline">
                                             Exclude&nbsp;<i class="fa fa-info-circle green-info"
                                             onclick="$('#include-help').slideDown();"></i>
                                         </label>
                                    </div>
                                    <div class="small-9 columns error" id="exclude-error">
                                        <input type="text" id="exclude"
                                        placeholder="Exclude folders or files">
                                        <small class="error"></small>
                                    </div>
                                </div>
                                <div class="clearfix">
                                    <div class="small-3 columns">
                                         <label id="include-label" for="include" class="right inline">
                                             Include&nbsp;<i class="fa fa-info-circle green-info"
                                                onclick="$('#include-help').slideDown();"></i>
                                         </label>
                                    </div>
                                    <div class="small-9 columns error" id="include-error">
                                        <input type="text" id="include"
                                        placeholder="Include folders or files">
                                        <small class="error"></small>
                                    </div>
                                    <div class="small-3 columns">&nbsp;</div>
                                    <div class="small-9 columns hide info-text panel" id="include-help">
                                        <i class="fa fa-times right" onclick="$('#include-help').slideUp();"></i>
                                        Include and Exclude fields accept some extended shell globbing patterns:
                                        <br>* Matches any string not containing '/'
                                        <br>? Matches any character except '/'
                                        <br>[...] Expands to a single character of those characters specified
                                            (ranges are acceptable)
                                        <br>** Matches any string
                                    </div>
                                </div>
                                <div class="clearfix">
                                    <div class="small-3 columns">
                                        <label id="passphrase_label" for="passphrase" class="right inline">Passphrase</label>
                                    </div>
                                    <div class="small-6 columns error" id="passphrase-error">
                                        <input type="password" id="passphrase" placeholder="Passphrase">
                                        <small class="error"></small>
                                    </div>
                                    <div class="small-3 columns">
                                        <label for="save_passphrase" class="left">Save&nbsp;
                                        <input id="save_passphrase" type="checkbox" class="right">
                                        </label>
                                    </div>
                                </div>
                            </fieldset>
                            <div class="clearfix">
                                <div class="small-6 columns">
                                    <a id="backup_button" class="button radius left small"
                                    onclick="if(check_fields()) backup(false);">
                                    <i class="fa fa-cloud-upload"></i>&nbsp;Backup Now</a>
                                </div>
                                <div class="small-6 columns">
                                    <a id="save_button" class="button radius right small success"
                                    onclick="if(check_fields()) save_backup_set();">
                                    <i class="fa fa-floppy-o"></i>&nbsp;Save</a>
                                </div>
                                <div class="small-3 columns">
                                    <a id="go_to_restore_button" class="button radius left small"
                                    onclick="go_to_restore()">
                                    <i class="fa fa-cloud-download"></i>&nbsp;Restore</a>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="content" id="status"></div>
                    <div class="content" id="timeview">
                        <div class="clearfix">
                            <div class="small-9 columns error" id="time-head-error">
                                <input type="hidden" id="time-path" placeholder="Select path"
                                    value="/">
                                <small class="error"></small>
                            </div>
                        </div>
                        <div class="clearfix">
                            <ul class="breadcrumbs" id="breadcrumbs"></ul>
                        </div>
                        <div class="clearfix">
                            <div class="small-4 columns left scroll-list" id="time-dates"></div>
                            <div class="small-8 columns scroll-list" id="time-contents"></div>
                        </div>
                    </div>
                </div>
                <div id="loader" class="hide text-center">
                    <i class="fa fa-spinner fa-pulse fa-2x gray-spin"></i>
                </div>
                <div id="msg" class="small-10 columns"></div>
            </div>
        </div>
        <script type="text/javascript">
            $(document).foundation();
        </script>
    </body>
</html>
