<!DOCTYPE html>
<html>
    <head>
        <script src="backup.js"></script>
        <script type="text/javascript">

            if(typeof clouds === 'undefined') {
                load_data_from_file(CLOUDS_CONF_FILE, show_cloud_msg);
            } else {
                show_cloud_msg(clouds);
            }

            function show_cloud_msg(data) {
                if(typeof clouds === 'undefined') {
                    if(data != "") {
                        clouds = JSON.parse(data).clouds;
                    } else {
                        clouds = [];
                    }
                }
                if(clouds.length == 0) {
                    $("#cloud-alert").show();
                }
            }

            load_data_from_file(BACKUP_CONF_FILE, render_backup_sets);

            function go_to_backup(backup) {
                selected_backup = backup;
                $("#backup-tab-link").trigger("click");
            }

            function render_backup_sets(data) {
                $("#backup_list").remove();
                // backups is undefined the first time, when
                // reading data from file
                if(typeof backups === 'undefined') {
                    if(data != "") {
                        backups = JSON.parse(data).backups;
                    } else {
                        backups = [];
                    }
                }
                if(backups.length == 0) {
                    $("#backup-alert").show();
                }
                var ul = $("<ul></ul>")
                    .attr("class", "no-bullet")
                    .attr("id", "backup_list");
                $.each(backups, function(i, backup) {
                    var li = $("<li></li>")
                        .attr("class", "clearfix backup-box")
                        .attr("id", "box_" + backup.name);
                    var a = $("<a>" + backup.name + "</a>")
                        .attr("href", "#")
                        .attr("id", "box_a_" + backup.name)
                        .attr("class", "left")
                        .attr("onclick", "go_to_backup('" + backup.name + "')");

                    li.append(a);

                    var a_del = $("<a><i class='fa fa-times-circle delete_icon'></i></a>")
                        .attr("href", "#")
                        .attr("class", "right")
                        .click(function() {
                            if(confirm("Are you sure you want to delete " + backup.name + '?' +
                                "\nNOTE: To actually remove backup sets from remote" +
                                " container you have to manually purge it.")) {
                                delete_backup(backup);
                            }
                        });
                    li.append(a_del);

                    ul.append(li);
                    $("#backup-table").append(ul);
                });

            }

        </script>
    </head>

    <body>
        <div class="row">
            <div class="small-12 columns panel hide" id="cloud-alert">
                <span>
                    <i class="fa fa-exclamation-circle"></i>
                    No cloud settings found. To start you must set a
                    <a onclick="$('#cloud-settings-link').trigger('click');">
                    cloud configuration.</a>
                </span>
            </div>
        </div>
        <div class="row">
            <div class="small-12 columns panel hide" id="backup-alert">
                <span>
                    <i class="fa fa-exclamation-circle"></i>
                    No backup sets found.
                    <a onclick="$('#backup-tab-link').trigger('click');">
                    Create a new one.</a>
                </span>
            </div>
        </div>
        <div class="row">
            <div class="small-12 columns" id="backup-table">
            </div>
        </div>
        <script type="text/javascript">
            $(document).foundation();
        </script>
    </body>
</html>
